<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Spyster - Player</title>
    <link rel="stylesheet" href="/api/spyster/static/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Connection Status -->
        <div id="connection-status" class="connection-status status-disconnected">
            Disconnected
        </div>

        <!-- Error Display -->
        <div id="error-display" class="error-display"></div>

        <!-- Header -->
        <header role="banner" class="text-center" style="margin-bottom: var(--space-xl);">
            <h1 id="page-title" class="text-primary" style="font-family: var(--font-display); font-size: var(--text-title);">
                SPYSTER
            </h1>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" role="main">
            <!-- Join View (placeholder) -->
            <div id="join-view" class="card" style="padding: var(--space-xl);">
                <h2 id="join-heading" class="text-center text-secondary" style="margin-bottom: var(--space-lg);">
                    Join Game
                </h2>
                <form id="join-form" role="form" aria-labelledby="join-heading" style="display: flex; flex-direction: column; gap: var(--space-md);">
                    <input
                        type="text"
                        id="player-name-input"
                        placeholder="Enter your name"
                        maxlength="20"
                        autocomplete="off"
                        autocapitalize="words"
                        style="
                            font-family: var(--font-body);
                            font-size: var(--text-body);
                            padding: var(--space-md);
                            border: 2px solid var(--color-accent-primary);
                            border-radius: var(--radius-md);
                            background-color: var(--color-bg-secondary);
                            color: var(--color-text-primary);
                            min-height: var(--touch-minimum);
                        "
                        aria-label="Enter your player name"
                        required
                    >
                    <button type="submit" id="join-button" class="btn btn-primary" aria-label="Submit and join the game">
                        JOIN GAME
                    </button>
                </form>
                <div id="error-message" class="error-message" style="display: none; margin-top: var(--space-md);"></div>
            </div>

            <!-- Lobby View -->
            <div id="lobby-view" class="card text-center" style="display: none; padding: var(--space-xl);">
                <h2 class="text-secondary" style="margin-bottom: var(--space-lg);">
                    Waiting for Host...
                </h2>
                <div id="lobby-player-count" class="text-primary" style="font-size: var(--text-heading); margin-bottom: var(--space-lg);">
                    0 players
                </div>

                <!-- Game Settings Display (Story 3.1) -->
                <div class="config-display">
                    <h3>Game Settings</h3>
                    <ul>
                        <li>Round Duration: <strong><span id="config-round-duration-display">7</span> minutes</strong></li>
                        <li>Number of Rounds: <strong><span id="config-num-rounds-display">5</span></strong></li>
                        <li>Location Pack: <strong><span id="config-location-pack-display">Classic</span></strong></li>
                    </ul>
                </div>

                <div id="player-list-container">
                    <h3 class="text-secondary" style="font-size: var(--text-body); margin-bottom: var(--space-md);">Players:</h3>
                    <ul id="player-list" class="player-list" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>

            <!-- Roles Loading View (Story 3.2) -->
            <div id="roles-loading-view" class="card text-center" style="display: none; padding: var(--space-xl);">
                <div class="loading-container">
                    <div class="spinner"></div>
                    <h2 class="text-secondary" style="margin-top: var(--space-lg);">Assigning roles...</h2>
                    <p class="help-text" style="margin-top: var(--space-md);">Please wait</p>
                </div>
            </div>

            <!-- Role Display View - Story 3.5 -->
            <div id="role-view" style="display: none;">
                <!-- Content will be dynamically rendered by renderRoleDisplay() -->
            </div>

            <!-- Questioning Phase View (Story 4.3) -->
            <div id="questioning-view" style="display: none;">
                <!-- Phase Header -->
                <div class="phase-header" style="margin-bottom: var(--space-lg);">
                    <h2 class="text-center text-secondary" style="margin-bottom: var(--space-md);">
                        Questioning Phase
                    </h2>
                    <!-- Timer -->
                    <div id="round-timer-player" class="timer-display" role="timer" aria-live="polite" style="text-align: center; margin-bottom: var(--space-lg);">
                        <span class="timer-value" style="font-size: var(--text-heading); color: var(--color-accent-primary);">0:00</span>
                    </div>
                </div>

                <!-- Turn Info (compact) - Story 4.3 -->
                <div id="turn-info-player" class="turn-info-compact card" style="margin-bottom: var(--space-lg); padding: var(--space-md); text-align: center;">
                    <span id="questioner-name-player" class="name-highlight">Player A</span>
                    <span class="turn-text" style="color: var(--color-text-secondary); padding: 0 var(--space-sm);">asks</span>
                    <span id="answerer-name-player" class="name-highlight">Player B</span>
                </div>

                <!-- Role Reference -->
                <div id="role-reference" class="role-reference card" style="margin-bottom: var(--space-lg); padding: var(--space-md);">
                    <!-- Populated by JavaScript based on player role -->
                </div>

                <!-- Call Vote Button -->
                <div class="action-controls">
                    <button id="call-vote-btn" class="btn btn-primary" style="width: 100%; min-height: var(--touch-minimum);" aria-label="Call a vote to identify the spy">
                        CALL VOTE
                    </button>
                </div>
            </div>

            <!-- Vote Phase View (Story 5.1) -->
            <div id="vote-view" class="phase-view" style="display: none;">
                <!-- Vote notification banner -->
                <div id="vote-notification" class="vote-notification" style="display: none;"></div>

                <!-- Vote header with timer and tracker -->
                <div class="vote-header">
                    <div class="timer-display">
                        <span id="vote-timer" role="timer" aria-live="polite">1:00</span>
                    </div>
                    <div id="vote-tracker" role="progressbar" aria-valuenow="0" aria-valuemax="7">
                        0/0 voted
                    </div>
                </div>

                <!-- Spy Mode Toggle (Story 5.4) - Hidden for non-spy -->
                <div id="spy-mode-toggle" class="spy-mode-toggle" style="display: none;">
                    <div class="spy-mode-options" role="tablist">
                        <button
                            type="button"
                            id="spy-vote-tab"
                            class="spy-mode-tab spy-mode-tab--active"
                            role="tab"
                            aria-selected="true"
                            aria-controls="vote-panel"
                        >
                            Vote
                        </button>
                        <button
                            type="button"
                            id="spy-guess-tab"
                            class="spy-mode-tab"
                            role="tab"
                            aria-selected="false"
                            aria-controls="guess-panel"
                        >
                            Guess Location
                        </button>
                    </div>
                </div>

                <!-- Player selection grid (Vote panel) -->
                <div id="vote-panel" class="vote-section">
                    <h2 class="vote-section-title">Select the Spy</h2>
                    <div id="player-cards-grid" class="player-cards-grid" role="radiogroup" aria-label="Select a player to vote for">
                        <!-- Player cards injected dynamically -->
                    </div>
                </div>

                <!-- Location Guess Panel (Story 5.4) - Hidden by default -->
                <div id="guess-panel" class="vote-section" style="display: none;" role="tabpanel">
                    <h2 class="vote-section-title">Where do you think they are?</h2>
                    <div id="location-list" class="location-list" role="radiogroup" aria-label="Select a location">
                        <!-- Location items injected dynamically -->
                    </div>
                    <div class="vote-actions">
                        <button id="submit-guess-btn" type="button" class="btn btn-primary btn-large" disabled>
                            SELECT A LOCATION
                        </button>
                    </div>
                </div>

                <!-- Confidence betting section (Story 5.2) -->
                <div id="confidence-section" class="vote-section confidence-section">
                    <h2 class="vote-section-title">How confident are you?</h2>

                    <div class="confidence-buttons" role="radiogroup" aria-label="Select your confidence level">
                        <!-- Low confidence -->
                        <button
                            type="button"
                            class="confidence-btn confidence-btn--selected"
                            data-confidence="1"
                            role="radio"
                            aria-checked="true"
                            aria-label="Low confidence: win 2, lose 1"
                        >
                            <span class="confidence-value">1</span>
                            <span class="confidence-label">SAFE</span>
                            <span class="confidence-reward">+2 / -1</span>
                        </button>

                        <!-- Medium confidence -->
                        <button
                            type="button"
                            class="confidence-btn"
                            data-confidence="2"
                            role="radio"
                            aria-checked="false"
                            aria-label="Medium confidence: win 4, lose 2"
                        >
                            <span class="confidence-value">2</span>
                            <span class="confidence-label">BOLD</span>
                            <span class="confidence-reward">+4 / -2</span>
                        </button>

                        <!-- ALL IN (High confidence) -->
                        <button
                            type="button"
                            class="confidence-btn confidence-btn--all-in"
                            data-confidence="3"
                            role="radio"
                            aria-checked="false"
                            aria-label="All in: win 6, lose 3"
                        >
                            <span class="confidence-value">3</span>
                            <span class="confidence-label">ALL IN</span>
                            <span class="confidence-reward">+6 / -3</span>
                        </button>
                    </div>
                </div>

                <!-- Submit button -->
                <div class="vote-actions">
                    <button id="submit-vote-btn" class="btn btn-primary btn-large" disabled>
                        SELECT A PLAYER
                    </button>
                </div>
            </div>

            <!-- Screen reader live region -->
            <div id="sr-announcer" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

            <!-- Reveal Phase View (Story 5.6, 5.7) -->
            <div id="reveal-view" class="phase-view" style="display: none;">
                <!-- Reveal header -->
                <div class="reveal-header">
                    <h1 class="reveal-title">The Votes Are In!</h1>
                </div>

                <!-- Conviction Banner (Story 5.7) -->
                <div id="conviction-banner" class="conviction-banner" style="display: none;">
                    <div class="conviction-result">
                        <div id="conviction-message" class="conviction-message"></div>
                        <div id="conviction-detail" class="conviction-detail"></div>
                    </div>
                    <div id="score-change" class="score-change"></div>
                </div>

                <!-- Spy guess result (if applicable) -->
                <div id="spy-guess-result" class="reveal-section" style="display: none;">
                    <div class="reveal-card reveal-card--spy">
                        <h2 class="reveal-card-title">Spy's Location Guess</h2>
                        <div id="spy-guess-location" class="reveal-highlight"></div>
                        <div id="spy-guess-outcome" class="reveal-outcome"></div>
                    </div>
                </div>

                <!-- Vote results grid -->
                <div class="reveal-section">
                    <h2 class="reveal-section-title">Who Voted For Whom</h2>
                    <div id="reveal-votes-grid" class="reveal-votes-grid">
                        <!-- Vote cards injected dynamically -->
                    </div>
                </div>

                <!-- Convicted player -->
                <div id="conviction-result" class="reveal-section">
                    <div class="reveal-card reveal-card--convicted">
                        <h2 class="reveal-card-title">Most Votes</h2>
                        <div id="convicted-player" class="reveal-highlight"></div>
                        <div id="conviction-count" class="reveal-subtext"></div>
                    </div>
                </div>

                <!-- Actual spy reveal -->
                <div class="reveal-section">
                    <div class="reveal-card reveal-card--spy-identity">
                        <h2 class="reveal-card-title">The Spy Was...</h2>
                        <div id="actual-spy" class="reveal-highlight reveal-spy-name"></div>
                    </div>
                </div>

                <!-- Location reveal -->
                <div class="reveal-section">
                    <div class="reveal-card reveal-card--location">
                        <h2 class="reveal-card-title">The Location Was</h2>
                        <div id="actual-location" class="reveal-highlight"></div>
                    </div>
                </div>

                <!-- Continue to scoring -->
                <div class="reveal-actions">
                    <div id="reveal-countdown" class="reveal-countdown">
                        Scoring in <span id="scoring-countdown">5</span>...
                    </div>
                </div>
            </div>

            <!-- Scoring View (placeholder) -->
            <div id="scoring-view" style="display: none;">
                <h2 class="text-center text-primary" style="margin-bottom: var(--space-lg);">
                    Leaderboard
                </h2>
                <div id="leaderboard" class="flex flex-col gap-md">
                    <!-- Leaderboard items will be inserted here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer role="contentinfo" class="text-center" style="margin-top: var(--space-2xl); padding: var(--space-lg);">
            <p class="text-secondary" style="font-size: var(--text-small);">
                Spyster
            </p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="/api/spyster/static/js/player.js"></script>
</body>
</html>
